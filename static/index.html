<script>
    const RENDER_URL = "https://timestamps-5nub.onrender.com"; 

    function runProcessing(event) {
        event.preventDefault();

        let xhr = new XMLHttpRequest();
        xhr.open("GET", `${RENDER_URL}/process`, true);
        document.getElementById("progress").innerHTML = "⏳ Processing started...";

        xhr.onload = function() {
            if (xhr.status === 200) {
                document.getElementById("progress").innerHTML = "✅ Processing complete! Checking file availability...";
                
                checkProcessingCompletion(); // ✅ New function to confirm files are ready
            } else {
                document.getElementById("progress").innerHTML = "❌ Error in processing!";
            }
        };

        xhr.onerror = function() {
            document.getElementById("progress").innerHTML = "❌ Network Error!";
        };

        xhr.send();
    }

    function checkProcessingCompletion() {
        let checkXhr = new XMLHttpRequest();
        checkXhr.open("GET", `${RENDER_URL}/status`, true); // ✅ Assuming your backend has an endpoint to confirm completion

        checkXhr.onload = function() {
            if (checkXhr.status === 200 && checkXhr.responseText === "completed") { 
                document.getElementById("progress").innerHTML = "✅ Files are ready!";
                document.getElementById("downloadBtn").disabled = false;
                document.getElementById("downloadBtn").style.display = "inline";  
            } else {
                document.getElementById("progress").innerHTML = "⏳ Processing still ongoing...";
                setTimeout(checkProcessingCompletion, 5000); // ✅ Retry after 5 sec if processing isn’t done
            }
        };

        checkXhr.onerror = function() {
            document.getElementById("progress").innerHTML = "❌ Error checking file status!";
        };

        checkXhr.send();
    }
</script>
